<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:table="sap.ui.table"
    xmlns:l="sap.ui.layout">

    <Dialog
        id="formulaDialog"
        title="Formula Configuration"
        contentWidth="40rem">

        <VBox>

            <Toolbar>
                <ComboBox
                    id="formulaComboBox"
                    selectionChange=".onFormulaSelect"
                    items="{
                        path: 'uniqueFormulaModel>/items',
                    filters: [
                        { path: 'TrdPrctyp', operator: 'EQ', value1: '3' }
                    ]}">
                            <core:Item
                                key="{uniqueFormulaModel>TrdFid}"
                                text="{uniqueFormulaModel>TrdPrcfnam}"
                            />
                </ComboBox>
                <Input 
                    id="formulaNameInput"
                    placeholder="Enter the formula name"
                    liveChange=".onFormulaNameLiveChange"
                    enabled="false">
                    <layoutData>
                        <l:GridData
                            span="XL3 L4 M2 S2"
                        />
                    </layoutData>
                </Input>
                <ToolbarSpacer/>
                <Button
                    icon="sap-icon://add"
                    text="Add"
                    type="Emphasized"
                    press=".onAddFormulaRow"/>
                <Button
                    icon="sap-icon://delete"
                    text="Delete"
                    type="Reject"
                    press=".onDeleteFormulaRow"/>
            </Toolbar>

            <table:Table
                id="formulaTable"
                selectionMode="MultiToggle"
                rows="{formulaModel>/items}">
                
                <table:columns>
                    <table:Column>
                        <Label text="Curve"/>
                        <table:template>
                            <ComboBox
                                id="curveValue"
                                width="100%"
                                selectedKey="{formulaModel>curve}"
                                enabled="{formulaModel>editable}" 
                                items="{s4HanaModel>/ZTA_MTM_CURVESet}">
                                <core:Item
                                    key="{s4HanaModel>TrdMtmcvD}"
                                    text="{s4HanaModel>TrdMtmcvD}"/>
                            </ComboBox>
                        </table:template>
                    </table:Column>

                    <table:Column>
                        <Label text="Percentage (%)"/>
                        <table:template>
                            <HBox width="100%">
                                <Input
                                    id="pcentValue"
                                    value="{formulaModel>percentage}"
                                    enabled="{formulaModel>editable}" 
                                    type="Number">
                                    <layoutData>
                                        <l:GridData span="XL5 L6 M6 S4" />
                                    </layoutData>
                                    </Input>
                                <Label text="%" width="1rem" class="sapUiTinyMarginBegin"/>
                            </HBox>
                        </table:template>
                    </table:Column>
                </table:columns>

            </table:Table>
        </VBox>

        <beginButton>
            <Button
                text="Submit"
                type="Emphasized"
                enabled="false"
                press=".onSubmitFormula"/>
        </beginButton>

        <endButton>
            <Button
                text="Cancel"
                press=".onCancelFormula"/>
        </endButton>

    </Dialog>
</core:FragmentDefinition>